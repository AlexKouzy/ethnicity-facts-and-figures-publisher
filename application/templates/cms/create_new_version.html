{% extends "base.html" %}
{% from "cms/forms.html" import render_version_radio %}
{% from "_shared/_breadcrumb.html" import breadcrumb %}

{% set breadcrumbs =
  [
    {"url": url_for('static_site.topic', uri=topic.uri), "text": topic.title},
    {"url": url_for('cms.edit_measure_page', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, version=measure.version), "text": measure.title},
  ]
%}

{% block bodyClasses %}rd_cms{% endblock %}

{% block messages %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class='grid-row'>
            <div class='column-full'>
                <div class="row">
                    <div class="flash-message">
                        {% for category, message in messages %}
                            <div data-alert
                                 class="alert-box {% if category == 'error' %}alert{% else %}{{ category }}{% endif %}">
                                <span>{{ message }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    {% endwith %}
{% endblock %}

{% block content %}
    {{ self.messages() }}

    <div class="grid-row">
        <div class="column-full">
            <h1 class="heading-large">Create new version</h1>
        </div>
    </div>

    <div class="grid-row">
        <div class="column-two-thirds new-version">
            <p>Current version: <b>{{ measure.version }}</b>
                <a href="{{ url_for('static_site.measure_page', topic=topic.uri, subtopic=subtopic.uri, measure=measure.uri, version=measure.version) }}">
                    View page
                </a>
            </p>
            <form method="POST"
                  action="{{ url_for('cms.new_version', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, version=measure.version) }}">
                <div class="version-type">New version type:</div>
                {% for version in form.version_type %}
                    <div class="input-radio">
                        {{ render_version_radio(version, measure) }}
                    </div>
                {% endfor %}
                <button class="button">Create new version in draft</button>
                {{ form.csrf_token }}
            </form>
        </div>

        <div class="column-one-third">
            &nbsp;
        </div>

    </div>
{% endblock %}
