

{%  macro render_contact_details_fields(name_field, email_field, phone_field, legend="Contact", further_explanation=False, disabled=False, class="") -%}

  <fieldset class="source-contact {{ class }}">
    <legend>{{ legend }} {% if further_explanation %}<span class="further-explanation">â€“ {{ further_explanation }}</span>{% endif %}</legend>

    <div class="contact-details">
      <div class="field-group">
        <div>{{ name_field.label }}</div>
        <div>{{ name_field(class="name", disabled=disabled) }}</div>
      </div>

      <div class="field-group">
        <div>{{ email_field.label }}</div>
        <div>{{ email_field(disabled=disabled) }}</div>
      </div>

      <div class="field-group">
        <div>{{ phone_field.label }}</div>
        <div>{{ phone_field(disabled=disabled) }}</div>
      </div>

    </div>

  </fieldset>

{%- endmacro %}


{%  macro render_textarea_field(field, rows='10', cols='100', disabled=False, diffs={}) -%}
    {{ field.label }}
    {% if field.errors %}
        <span class="error-message">{{ field.errors[0]}}</span>
        {{ field(rows=rows, cols=cols, class="error") }}
        {% if diffs %}
            <p>Your update to "{{ field.label.text }}" is highlighted green
                and possible deletions are highlighted red. If these changes are fine,
                save the page, otherwise edit the copy above and then save.</p>
            <div class="differences">
                {{ diffs[field.name]| render_markdown }}
            </div>
        {% endif %}
    {% else %}
        {{ field(rows=rows, cols=cols, disabled=disabled)}}
    {% endif %}
{%- endmacro %}


{%  macro render_field(field, disabled=False, label_class=None, class="", hint=None, diffs={}) -%}
    {% if label_class %}
        {{ field.label(class=label_class) }}
    {% else %}
        {{ field.label }}
    {% endif %}

    {% if field.errors %}
        <span class="error-message">{{ field.errors[0]}}</span>
        {{ field(class="error " + class) }}
        {% if diffs %}
             <p>Your update to "{{ field.label.text }}" is highlighted green
                and possible deletions are highlighted red. If these changes are fine,
                save the page, otherwise edit the copy above and then save.</p>
            <div class="differences">
                {{ diffs[field.name] | render_markdown }}
            </div>
        {% endif %}
    {% else %}
        {% if hint %}
            <span class="form-hint">{{ hint }}</span>
        {% endif %}
        {{ field(disabled=disabled, class=class)}}
    {% endif %}
{%- endmacro %}


{%  macro render_version_radio(field, measure) -%}

    <label>
      {{ field }}
    <b>{{ measure.next_version_number_by_type(field.data) }}</b>
    {%  if field.data == 'minor' %}
        Edit this edition (eg for clarifications or corrections)
    {%  else %}
        Create new edition (eg after new data becomes available)
    {% endif %}
  </label>
{%- endmacro %}

{%  macro render_checkboxes(fields, legend, disabled=False, label_class=None, class="", errors=False) -%}
    <div class="form-group {% if errors %}form-group-error{%  endif %}" id="{{ legend | lower | replace(' ', '-')}}">
        <fieldset>
            <legend>{{ legend }}
                {% if errors %}
                    <span class="error-message">Select at least one</span>
                {% endif %}
            </legend>
            {% for field in fields %}
                <div class="multiple-choice">
                    {{ field(disabled=disabled)}}
                    {% if label_class %}
                        {{ field.label(class=label_class) }}
                    {% else %}
                        {{ field.label }}
                    {% endif %}
                </div>
            {% endfor %}
        </fieldset>
    </div>
{%- endmacro %}

{%  macro render_radio_field(form, field, legend, disabled=False) -%}

      <div class="form-group {% if field.errors %}form-group-error{% endif %}">
        <fieldset id="{{ legend | lower | replace(' ', '-') }}">
          <legend>{{ legend }}
            {% if field.errors %}
                <span class="error-message">Select one</span>
            {% endif %}
          </legend>

            {% for input in field %}

                <div class="multiple-choice">
                  {%  if input.data == 10 %}
                      {{  input(**{'aria-controls': 'frequency-other-field', 'aria-expanded': 'false', 'disabled': disabled}) }}
                  {%  else %}
                    {{ input(disabled=disabled) }}
                  {%  endif %}
                  {{ input.label }}
                </div>

            {% endfor %}

            {#  note the assumption is that 'other' radio button is always last #}
            {%  set other_id = 'frequency_id-%d' % (field.choices | count - 1)  %}

            <div class="panel panel-border-narrow form-group {%  if form.frequency_other.errors %}form-group-error{% endif %}" id="frequency-other-field">

              {{ form.frequency_other.label(class="form-label") }}
                {%  if form.frequency_other.errors %}
                    <span class="error-message">Please specify</span>
                {% endif %}
              {{ form.frequency_other(disabled=disabled) }}

            </div>

        </fieldset>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                showHideControl(document.getElementById('{{ other_id }}'))
            })
        </script>

      </div>

{%- endmacro %}
